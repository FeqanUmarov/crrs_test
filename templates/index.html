{% load static %}
<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>CRRS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{% static 'vendor/ol.css' %}">
  <script src="{% static 'vendor/ol.js' %}" defer></script>

  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script src="{% static 'js/app_toast.js' %}?v=1" defer></script>

  <script>
    window.APP = { ticket: "{{ ticket|default_if_none:''|escapejs }}" };
  </script>

{{ validation_state|json_script:"tekuis-validation-state" }}
{{ meta_id|json_script:"tekuis-meta-id" }}
  <script>
    window.META_ID = JSON.parse(
      document.getElementById("tekuis-meta-id").textContent || "null"
    );
    window.TEKUIS_VALIDATION_STATE = JSON.parse(
      document.getElementById("tekuis-validation-state").textContent || "{}"
    );
  </script>


  <script src="{% static 'js/tekuis-validator.js' %}?v=1" defer></script>
  <script src="{% static 'js/rtLoading.js' %}?v=1" defer></script>

  <script src="{% static 'js/utils.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/core/ticket.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/core/auth.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/basemaps.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/feature-ownership.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/overlays.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/geometry.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/styles.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/uploaded-layer.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/map/tekuis-cache.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/panel.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/uploads.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/data-panel.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/basemaps-panel.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/layers-panel.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/tekuis-save.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/services/tekuis-validation-service.js' %}?v=20251101.1" defer></script>
  <script src="{% static 'js/ui/tekuis-validation-workflow.js' %}?v=20251101.1" defer></script>
  <script src="{% static 'js/ui/info-mode.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/layer_colors.js' %}?v=1" defer></script>
  <script src="{% static 'js/map_core.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/main/tekuis-necas.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/main/bootstrap.js' %}?v=20251024.2" defer></script>
  <script src="{% static 'js/main/editing.js' %}?v=20251024.2" defer></script>
  <script src="{% static 'js/main/layers.js' %}?v=20251024.2" defer></script>
  <script src="{% static 'js/main.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/ui/tekuis-topology.js' %}?v=20250925.1" defer></script>
  <script src="{% static 'js/attributes_panel.js' %}?v=1" defer></script>
  <script src="{% static 'js/tekuis_erase.js' %}?v=1" defer></script>
  <script src="{% static 'js/editvertex.js' %}?v=1" defer></script>
  <!-- <script src="{% static 'js/tekuis_erase_with_transfer.js' %}?v=1" defer></script> -->
  <script src="{% static 'js/tekuis-switch.js' %}?v=1" defer></script>
  <script src="{% static 'js/rtVertexToolbar.js' %}?v=1" defer></script>
  <script src="{% static 'js/rt_move.js' %}?v=20251024.1"></script>



  <script src="{% static 'js/history.js' %}?v=1" defer></script>


  <script>
    window.RT_ICONS = {
      info:         "{% static 'icons/images/info.svg' %}",
      erase:        "{% static 'icons/images/poygon-erase.svg' %}",
      editVertices: "{% static 'icons/images/vertex.svg' %}",
      draw:         "{% static 'icons/images/edit.svg' %}",
      snap:         "{% static 'icons/images/snap.svg' %}",
      deleteSel:    "{% static 'icons/images/delete.svg' %}",
      save:         "{% static 'icons/images/save.svg' %}",
      move:         "{% static 'icons/images/move.svg' %}",
      explode:      "{% static 'icons/images/explode.svg' %}",
      cutpolygon:   "{% static 'icons/images/cutpolygon.svg' %}"
    };
  </script>

  <script>window.HISTORY_ICON = "{% static 'icons/images/clock.svg' %}";</script>

  <script>
    window.HISTORY_STATUS_ICONS = {
      attach: "{% static 'icons/images/attach-history.png' %}",
      gis: "{% static 'icons/images/research-history.png' %}",
      tekuis: "{% static 'icons/images/parcel-history.png' %}",
    };
  </script>

  <style>
.right-tools{
  position:absolute; right:22px; top:88px; z-index:999;
  display:flex; flex-direction:column; gap:10px; padding:10px 9px;
  border-radius:16px;
  background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(243,248,255,.92));
  border:1px solid rgba(148,163,184,.35);
  box-shadow:
    0 8px 20px rgba(15,23,42,.05),
    0 2px 6px rgba(15,23,42,.03);
  backdrop-filter: blur(6px);
}
.rt-btn{
  width:52px; height:52px; border-radius:16px;
  border:1px solid rgba(226,232,240,.9);
  cursor:pointer; display:flex; align-items:center; justify-content:center;
  background:linear-gradient(145deg, #ffffff, #e9f2ff);
  transition:transform .15s ease, box-shadow .18s ease, border-color .18s ease;
}
.rt-btn:hover{
  transform:translateY(-2px);
  box-shadow:
    0 14px 24px rgba(15,23,42,.08),
    inset 0 1px 0 rgba(255,255,255,.425);
  border-color:rgba(148,163,184,.6);
    }
    .rt-btn:active{
      transform:translateY(0);
    }
    .rt-btn.active{
      background:linear-gradient(145deg, #ecfeff, #cffafe);
      border-color:rgba(6,182,212,.55);
    }
    .rt-btn.active{
      background:linear-gradient(145deg, #ecfeff, #cffafe);
      border-color:rgba(6,182,212,.55);
      box-shadow:
        0 0 0 3px rgba(6,182,212,.2),
        0 10px 20px rgba(6,182,212,.25);

    }
    .rt-icon{ width:24px; height:24px; }
    .rt-icon-img{ width:26px; height:26px; object-fit:contain; }
    .rt-btn[data-color] .rt-icon-img,
    .rt-btn[data-color] .rt-icon{
      filter: var(--rt-icon-filter, none);
    }
    .rt-btn[data-color="info"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(39%) sepia(85%) saturate(1676%) hue-rotate(202deg) brightness(101%) contrast(94%); }
    .rt-btn[data-color="draw"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(53%) sepia(68%) saturate(470%) hue-rotate(94deg) brightness(95%) contrast(92%); }
    .rt-btn[data-color="snap"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(46%) sepia(58%) saturate(2059%) hue-rotate(229deg) brightness(100%) contrast(95%); }
    .rt-btn[data-color="delete"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(38%) sepia(84%) saturate(5446%) hue-rotate(349deg) brightness(96%) contrast(95%); }
    .rt-btn[data-color="explode"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(55%) sepia(63%) saturate(4000%) hue-rotate(356deg) brightness(98%) contrast(97%); }
    .rt-btn[data-color="cut"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(64%) sepia(78%) saturate(3550%) hue-rotate(360deg) brightness(100%) contrast(95%); }
    .rt-btn[data-color="save"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(46%) sepia(68%) saturate(498%) hue-rotate(113deg) brightness(93%) contrast(90%); }
    .rt-btn[data-color="erase"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(42%) sepia(63%) saturate(3800%) hue-rotate(332deg) brightness(98%) contrast(96%); }
    .rt-btn[data-color="move"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(54%) sepia(52%) saturate(2191%) hue-rotate(154deg) brightness(98%) contrast(94%); }
    .rt-btn[data-color="edit"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(38%) sepia(66%) saturate(3379%) hue-rotate(232deg) brightness(97%) contrast(92%); }
    .rt-btn[data-color="history"]{ --rt-icon-filter: brightness(0) saturate(100%) invert(43%) sepia(12%) saturate(563%) hue-rotate(173deg) brightness(93%) contrast(87%); }

.ui-tooltip{
  position:relative;
}
.ui-tooltip::after,
.ui-tooltip::before{
  position:absolute;
  opacity:0;
  pointer-events:none;
  transition:opacity .15s ease, transform .15s ease;
  z-index:2000;
}
.ui-tooltip::after{
  content:attr(data-tooltip);
  bottom:calc(100% + 10px);
  left:50%;
  transform:translate(-50%, 4px) scale(.98);
  padding:6px 10px;
  font-size:12px;
  line-height:1.25;
  letter-spacing:.01em;
  color:#f8fafc;
  white-space:nowrap;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.35);
  background:linear-gradient(135deg, rgba(15,23,42,.98), rgba(30,41,59,.98));
  box-shadow:0 8px 18px rgba(15,23,42,.2);
  backdrop-filter: blur(6px);
}
.ui-tooltip::before{
  content:"";
  bottom:calc(100% + 4px);
  left:50%;
  width:10px;
  height:10px;
  transform:translate(-50%, 4px) rotate(45deg);
  background:linear-gradient(135deg, rgba(15,23,42,.98), rgba(30,41,59,.98));
  border-left:1px solid rgba(148,163,184,.35);
  border-top:1px solid rgba(148,163,184,.35);
}
.ui-tooltip:hover::after,
.ui-tooltip:hover::before,
.ui-tooltip:focus-visible::after,
.ui-tooltip:focus-visible::before{
  opacity:1;
}
.ui-tooltip:hover::after,
.ui-tooltip:focus-visible::after{
  transform:translate(-50%, 0) scale(1);
}
.ui-tooltip:hover::before,
.ui-tooltip:focus-visible::before{
  transform:translate(-50%, 0) rotate(45deg);
}
.ui-tooltip.tooltip-left::after{
  top:50%;
  left:auto;
  right:calc(100% + 12px);
  bottom:auto;
  transform:translate(6px, -50%) scale(.98);
}
.ui-tooltip.tooltip-left::before{
  top:50%;
  left:auto;
  right:calc(100% + 4px);
  bottom:auto;
  transform:translate(0, -50%) rotate(45deg);
  border-left:none;
  border-top:none;
  border-right:1px solid rgba(148,163,184,.35);
  border-bottom:1px solid rgba(148,163,184,.35);
}
.ui-tooltip.tooltip-left:hover::after,
.ui-tooltip.tooltip-left:focus-visible::after{
  transform:translate(0, -50%) scale(1);
}
.ui-tooltip.tooltip-left:hover::before,
.ui-tooltip.tooltip-left:focus-visible::before{
  transform:translate(0, -50%) rotate(45deg);
}
.ui-tooltip:not([data-tooltip])::after,
.ui-tooltip:not([data-tooltip])::before,
.ui-tooltip[data-tooltip=""]::after,
.ui-tooltip[data-tooltip=""]::before{
  display:none;
}

    .kv{
      display:grid; grid-template-columns: 180px 1fr; gap:6px 12px;
      font-size:14px; line-height:1.35;
    }
    .kv .k{ color:#6b7280; }
    .kv .v{ color:#111827; font-weight:500; word-break:break-all; }
    .kv .sep{ grid-column:1/-1; height:1px; background:#e5e7eb; margin:6px 0; }
    .kv .h{ grid-column:1/-1; font-size:12px; color:#374151; text-transform:uppercase; letter-spacing:.04em; margin-top:8px;}
  </style>
</head>
<body>
  <div class="app">

    <aside class="sidebar">
      <button id="sidebarToggle" class="sidebar-toggle" title="Genişləndir" aria-label="Sidebar toggle">›</button>

      <div class="sidebar-brand" aria-label="Qurum məlumatı">
        <img class="sidebar-brand-logo" src="{% static 'icons/images/emlak.png' %}" alt="Daşınmaz Əmlakın Dövlət Kadastrı və Reyestri loqosu">
        <div class="sidebar-brand-text" aria-hidden="true">
          Daşınmaz Əmlakın Dövlət<br>
          Kadastrı və Reyestri<br>
          Publik Hüquqi Şəxsi
        </div>
      </div>
      <button class="tool-btn" data-panel="contents" data-icon-tone="upload" title="Məlumat daxil et" aria-label="Məlumat daxil et">
        <img class="tb-ico" src="{% static 'icons/images/upload.svg' %}" alt="Məlumat daxil et ikonu">
        <span class="tb-label">Məlumat daxil et</span>
      </button>

      <button class="tool-btn" data-panel="symbology" data-icon-tone="basemap" title="Basemaps" aria-label="Basemaps">
        <img class="tb-ico" src="{% static 'icons/images/basemap.svg' %}" alt="Basemap ikonu">
        <span class="tb-label">Basemaps</span>
      </button>

      <button class="tool-btn" data-panel="layers" data-icon-tone="layers" title="Laylar" aria-label="Laylar">
        <img class="tb-ico" src="{% static 'icons/images/layers.svg' %}" alt="Laylar ikonu">
        <span class="tb-label">Laylar</span>
      </button>

      <button class="tool-btn" data-panel="info" data-icon-tone="info" title="Məlumatlar" aria-label="Məlumatlar">
        <img class="tb-ico" src="{% static 'icons/images/information.svg' %}" alt="Məlumatlar ikonu">
        <span class="tb-label">Məlumatlar</span>
      </button>


      <button class="tool-btn" data-panel="attributes" data-icon-tone="attributes" title="Atribut məlumatları" aria-label="Atribut məlumatları">
        <img class="tb-ico" src="{% static 'icons/images/att.svg' %}" alt="Atribut ikonu">
        <span class="tb-label">Atribut məlumatları</span>
      </button>
    </aside>

    <main class="workspace">
      <div id="map" class="map"></div>
      <div class="right-tools" id="rightTools"></div>

      <section id="side-panel" class="side-panel" hidden aria-hidden="true">
        <div id="panel-indicator" class="panel-indicator" hidden></div>

        <div class="panel-header">
          <span class="panel-title">Panel</span>
          <button id="panel-close" class="panel-close" aria-label="Close">×</button>
        </div>
        <div class="panel-body"></div>
      </section>
    </main>
  </div>
</body>
</html>